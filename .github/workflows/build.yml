# ============================================================
# GitHub Actions è‡ªåŠ¨æ‰“åŒ…å·¥ä½œæµ
# åŠŸèƒ½ï¼šè‡ªåŠ¨æ„å»º Windows (exe) å’Œ macOS (app) ç‰ˆæœ¬
# ============================================================

name: Build Releases

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  # --------------------------------------------------------
  # Windows æ‰“åŒ…ä»»åŠ¡
  # --------------------------------------------------------
  build-windows:
    runs-on: windows-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: å®‰è£… PyInstaller
        run: pip install pyinstaller

      - name: æ‰“åŒ… Windows EXE
        run: |
          pyinstaller --onefile --windowed --name "Windsurfè´¦å·åˆ‡æ¢å™¨_Windows" --icon=NONE windsurf_win.py

      - name: ä¸Šä¼  Windows æ„å»ºäº§ç‰©
        uses: actions/upload-artifact@v4
        with:
          name: Windsurf-Windows-exe
          path: dist/Windsurfè´¦å·åˆ‡æ¢å™¨_Windows.exe

  # --------------------------------------------------------
  # macOS æ‰“åŒ…ä»»åŠ¡
  # --------------------------------------------------------
  build-macos:
    runs-on: macos-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: å®‰è£… PyInstaller
        run: pip install pyinstaller

      - name: æ‰“åŒ… macOS APP
        run: |
          pyinstaller --onefile --windowed --name "Windsurfè´¦å·åˆ‡æ¢å™¨_Mac" windsurf_mac.py

      - name: åˆ›å»º DMG å®‰è£…åŒ…
        run: |
          mkdir -p dmg_content
          cp -r "dist/Windsurfè´¦å·åˆ‡æ¢å™¨_Mac.app" dmg_content/ 2>/dev/null || cp "dist/Windsurfè´¦å·åˆ‡æ¢å™¨_Mac" dmg_content/
          hdiutil create -volname "Windsurfè´¦å·åˆ‡æ¢å™¨" -srcfolder dmg_content -ov -format UDZO "Windsurfè´¦å·åˆ‡æ¢å™¨_Mac.dmg"

      - name: ä¸Šä¼  macOS æ„å»ºäº§ç‰©
        uses: actions/upload-artifact@v4
        with:
          name: Windsurf-Mac-dmg
          path: |
            Windsurfè´¦å·åˆ‡æ¢å™¨_Mac.dmg
            dist/Windsurfè´¦å·åˆ‡æ¢å™¨_Mac

  # --------------------------------------------------------
  # åˆ›å»º Release å‘å¸ƒ
  # --------------------------------------------------------
  release:
    needs: [build-windows, build-macos]
    runs-on: ubuntu-latest
    if: startsWith(github.ref, 'refs/tags/')
    permissions:
      contents: write
    steps:
      - name: ä¸‹è½½æ‰€æœ‰æ„å»ºäº§ç‰©
        uses: actions/download-artifact@v4
        with:
          path: artifacts

      - name: æ˜¾ç¤ºæ–‡ä»¶ç»“æ„
        run: find artifacts -type f

      - name: åˆ›å»º GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            artifacts/Windsurf-Windows-exe/*
            artifacts/Windsurf-Mac-dmg/*
          body: |
            ## ğŸš€ Windsurf è´¦å·åˆ‡æ¢å™¨
            
            **çªç ´ Claude 4.5 æ¨¡å‹ 30 åˆ†é’Ÿç­‰å¾…é™åˆ¶ï¼**
            
            ### ğŸ“¦ ä¸‹è½½è¯´æ˜
            - **Windows ç”¨æˆ·**: ä¸‹è½½ `Windsurfè´¦å·åˆ‡æ¢å™¨_Windows.exe`
            - **macOS ç”¨æˆ·**: ä¸‹è½½ `Windsurfè´¦å·åˆ‡æ¢å™¨_Mac.dmg` æˆ– `Windsurfè´¦å·åˆ‡æ¢å™¨_Mac`
            
            ### âš ï¸ ä½¿ç”¨å‰å¿…è¯»
            1. å…ˆåœ¨ Windsurf ä¸­æ‰‹åŠ¨ç™»å½•è´¦å·
            2. å®Œå…¨å…³é—­ Windsurf
            3. è¿è¡Œæœ¬å·¥å…·ä¿å­˜è´¦å·
            4. é‡å¤ä»¥ä¸Šæ­¥éª¤ä¿å­˜å¤šä¸ªè´¦å·
            5. éœ€è¦åˆ‡æ¢æ—¶ï¼Œå…³é—­ Windsurf åä½¿ç”¨æœ¬å·¥å…·åˆ‡æ¢
            
            ### ğŸ“ è”ç³»ä½œè€…
            - å¾®ä¿¡: 1837620622ï¼ˆä¼ åº·kkï¼‰
            - é‚®ç®±: 2040168455@qq.com
            - å’¸é±¼/Bç«™: ä¸‡èƒ½ç¨‹åºå‘˜
            
            ---
            â­ å¦‚æœè§‰å¾—æœ‰ç”¨ï¼Œè¯·ç»™ä¸ª Star æ”¯æŒä¸€ä¸‹ï¼
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
